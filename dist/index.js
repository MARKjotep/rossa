// @bun
var v=function(t,n,r,o){var i=arguments.length,s=i<3?n:o===null?o=Object.getOwnPropertyDescriptor(n,r):o,e;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(t,n,r,o);else for(var f=t.length-1;f>=0;f--)if(e=t[f])s=(i<3?e(s):i>3?e(n,r,s):e(n,r))||s;return i>3&&s&&Object.defineProperty(n,r,s),s};var tt=(t,n)=>{if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(t,n)};import{Auth as $n}from"authored";var nt=(t)=>typeof t==="function";var J=(t)=>{return!isNaN(parseFloat(t))&&isFinite(t)};var rt=(t)=>{return t instanceof Uint8Array||t instanceof ArrayBuffer||typeof t==="string"};var X=(t)=>typeof t==="string",T=(t)=>Array.isArray(t),ot=(t)=>typeof t==="object";var it=(t)=>{return Number.isInteger(Number(t))};function st(t,n){p(n).forEach(([r,o])=>{ft(t,r,{value:o,writable:!1,configurable:!1,enumerable:!0})})}class M{static set p(t){if(Array.isArray(t))console.log(...t);else console.log(t)}}class G{_c=0;_id="";constructor(t){if(this._c=0,this._id=t??y(5),t?.includes("-")){let[n,r]=[t.split("-").slice(0,-1).join("-"),t.split("-").slice(-1)[0]];this._id=n,this._c=J(r)?parseInt(r):0}}get id(){return this._id+"-"+this._c}get mid(){return this._id+"-"+ ++this._c}}var et=(t,n)=>{let[r,o]=n.replace(/bytes=/,"").split("-").map((i,s)=>{let e=parseInt(i,10);return isNaN(e)?s===0?0:t-1:e});return[r,o,t]};var Un=new RegExp(/(\d+)(\d*)/,"m"),Kt=(t)=>Array.from({length:t},(n,r)=>r),ut="ABCDEFGHIJKLMNOPQRSTUVWXYZ",mt="abcdefghijklmnopqrstuvwxyz",Vt=Kt(10).join("");var C=(t)=>JSON.stringify(t),pt=(t)=>{return JSON.parse(t)},P=(t)=>{if(t.startsWith("webkit"))t="-"+t;return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},y=(t)=>{let n=ut+mt;return Array.from({length:t},(r,o)=>n+(o?Vt:"")).reduce((r,o)=>{return r+=o.charAt(Math.floor(Math.random()*o.length))},"")};var In=[...ut,...mt];var B=(t,n)=>{let r=n==="/"?"":n;return n.startsWith("/")?t+r:n};class a extends Map{obj(t){t&&p(t).forEach(([n,r])=>this.set(n,r))}map(t){t.forEach((n,r)=>{if(n instanceof a)this.set(r,n);else if(T(n)){if(this.lacks(r))this.set(r,[]);this.get(r).push(...n)}else if(ot(n))this.ass(r,n);else this.set(r,n)})}ass(t,n){if(!this.has(t))this.set(t,{});d(this.get(t),n)}lacks(t){return!this.has(t)}init(t,n){return this.has(t)?this.get(t):this.set(t,n).get(t)}}var{values:E,keys:Y,entries:p}=Object;var kt=Object.hasOwn;var{defineProperty:ft,assign:d}=Object,$=(t)=>{return Object.keys(t).length};function ht(t){return class extends t{constructor(...n){super(...n);let r=new Map;return new Proxy(this,{get(o,i){let s=`__${i}`;if(!r.has(s)){let e=o[i];if(nt(e))e=function(...f){let u=`${s}_${JSON.stringify(f)}`;if(!r.has(u)){let m=o[i].apply(o,f);r.set(u,m)}return r.get(u)};r.set(s,e)}return r.get(s)},set(o,i,s){let e=`__${i}`;return r.set(e,s),!0}})}}}var b=(t,n)=>{return{name:t,content:n}},vt=(t,n)=>{return{property:t,content:n}},tn=(t,n)=>{return{"http-equiv":t,content:n}};class Z{metas=[];constructor(t){t&&this.metas.push(b("description",t))}author(t){return this.meta=b("author",t),this}charset(t){return this.meta={charset:t},this}keywords(...t){return this.meta=b("keywords",t.join(", ")),this}viewport(t){let n=p(t).map(([r,o])=>[P(r),String(o)].join("="));return this.meta=b("viewport",n.join(", ")),this}httpEquiv(t){return p(t).forEach(([n,r])=>{this.meta=tn(P(n),String(r))}),this}robots(...t){return this.meta=b("robots",t.join(", ")),this}themeColor(t){return this.meta=b("theme-color",t),this}openGraph(t){return p(t).forEach(([n,r])=>{this.meta=vt("og:"+n,String(r))}),this}twitter(t){return p(t).forEach(([n,r])=>{this.meta=b("twitter:"+n,String(r))}),this}and(t){return this}set meta(t){this.metas.push(t)}}var nn=["charset","name","property","http-equiv"],lt=(t,n)=>{n.forEach((r)=>{for(let o of nn)if(o in r){let i=r[o];t[`${o}_${o==="charset"?"":i}`]=r}})},rn=(t,n)=>{n.forEach((r)=>{if("href"in r){let o=r.href;t[`${o}`]=r}})};class at{_head;idm;constructor(t){this._head=new a(t)}set head(t){p(t).forEach(([n,r])=>{if(n==="title"||n==="base"){if(r!==void 0)this._head.set(n,r);return}if(r instanceof Z)return lt(this._head.init("meta",{}),r.metas);if(!T(r))return;switch(n){case"meta":return lt(this._head.init("meta",{}),r);case"link":return rn(this._head.init("link",{}),r);case"script":if(r.length){this._head.init(n,[]);let o=r.map((i)=>{if(!i.yid&&this.idm)i.yid="sc"+this.idm.mid;return i});this._head.get(n).push(...o)}return}})}get head(){return this._head}set id(t){this.idm=new G(t)}}class on{lang="en";htmlHead=new a;head;constructor(){this.head=(t={})=>{let n=new at(this.htmlHead);n.head=t,this.htmlHead=n.head}}}var ct=(t,n="",{maxAge:r,expires:o,path:i,domain:s,secure:e,httpOnly:f,sameSite:u})=>{if(r instanceof Date)r=r.getSeconds();if(o instanceof Date)o=o.toUTCString();else if(o===0)o=new Date().toUTCString();return[["Domain",s],["Expires",o],["Max-Age",r],["Secure",e],["HttpOnly",f],["Path",i],["SameSite",u]].reduce((h,[w,g])=>{if(g!==void 0)h.push(`${w}=${g}`);return h},[`${t}=${n}`]).join("; ")};var W=(t,n=!1)=>{if(J(t))return[+t,it(t)?"int":"float"];if(n&&/\.\w+$/.test(t))return[t,"file"];if(t==="/")return[t,"-"];if(t.length===36&&t.match(/\-/g)?.length===4)return[t,"uuid"];return[t,"string"]},S=(t)=>{let n=t.startsWith("/")?t:"/"+t,r=n.match(/(?<=\/)[^/].*?(?=\/|$)/g)??["/"],[o,i]=r.reduce(([s,e],f)=>{if(f.includes("<")){let u=f.match(/(?<=<)[^/].*?(?=>|$)/g);if(u?.length){let[m,h]=u[0].split(":");if(m&&h)s.push(m),e.push(h)}}else s.push(f===">"?"/":f);return[s,e]},[[],[]]);if(n.endsWith("/")&&n.length>1)o.push("/");return{parsed:o,args:i}};class N{storage=new a;cache(t,n){if(this.storage.lacks(t))this.storage.set(t,n());return this.storage.get(t)}}var sn=["int","float","file","uuid","string"],en=new N;class L{_storage=new a;set(t){let{parsed:n,path:r}=t,o=C(n);if(!this._storage.get(o))this._storage.set(o,t);else throw`path: ${r} already used.`}get(t){let{parsed:n}=en.cache(t,()=>S(t)),r={},o=this._storage.get(C(n));if(!o&&t!=="/")for(let i of this._storage.keys()){let s=[],e=pt(i);if(n.length===e.length){let f=e.map((h,w)=>{let g=W(n[w],n.length-1===w);if(h===g[0])return g[0];if(sn.includes(g[1]))return s.push(g[0]),g[1];return h}),u=C(f);if(this._storage.has(u)){o=this._storage.get(u),o?.args.forEach((h,w)=>{r[h]=s[w]});break}}}return[o,r]}}class U{constructor(...t){t.forEach((n)=>{if(!this[n])this[n]=new L})}get(t){return this[t]}}class I{path="";parsed=[];args=[];constructor(t){st(this,{path:t,...S(t)})}}class A{date;constructor(t){this.date=t?new Date(t):new Date}delta(t=null,n=!1){let r=A.delta(this.date.getTime(),t);return n?new Date(r):r}timed(t){if(!t)return this.date;return[["year","FullYear"],["month","Month"],["day","Date"],["hour","Hours"],["minute","Minutes"],["second","Seconds"]].reduce((r,[o,i])=>{let s=t[o];return s?new Date(r[`set${i}`](r[`get${i}`]()+s)):r},new Date(this.date))}static delta(t,n=null){return n?n-t:t-Date.now()}static get now(){return Date.now()}}var{file:mn}=globalThis.Bun;import{JWTInterface as fn}from"authored";class gt{session;jwt;jwtInt;constructor(){this.jwtInt=new fn}init(t){this.session=t.session,this.jwt=t.jwt}}var l=new gt;class x{__session;__jwt;get session(){if(!this.__session)this.__session=l.session.new;return this.__session}set session(t){this.__session=t}get jwt(){if(!this.__jwt)this.__jwt=l.jwt.new;return this.__jwt}set jwt(t){this.__jwt=t}get timedJWT(){return l.jwtInt.jwt()}setServerSession(t){let{__jwt:n,__session:r}=t;this.__session=r,this.__jwt=n}}var yt=async(t,n)=>{await l.session.saveSession(t,n)};async function St({sid:t,jwtv:n,refreshjwt:r},o){let i=new x;if(t){if(i.session=await l.session.openSession(t),!i.session.new)o.session=!0}if(n){if(i.jwt=l.jwtInt.open(n,{hours:6}),!i.jwt.new)o.jwt=!0;if(r){if(!(await l.jwt.openSession(r)).new)o.jwt_refresh=!0}}if("session"in o||"jwt"in o)return i}var un={session(...t){return j(t[0],t[2],"session")},jwt(...t){return j(t[0],t[2],"jwt")},jwt_refresh(...t){return j(t[0],t[2],"jwt_refresh")}},j=(t,n,r)=>{let o=n.value;return n.value=async function(i={}){if(r in i&&i.session)return delete i[r],o.call(t,i);return{error:401}},n};var pn=["GET","POST","PUT","DELETE","OPTIONS"];class Rt extends I{config;_class;options="";bytes;fileType="text/plain";fileSize=0;constructor(t,n={}){super(t);this.config=n}set serverClass(t){this._class=t,this.options=pn.filter((n)=>t.prototype[n.toLowerCase()]).join(", ")}get serverClass(){return this._class}async loadBytes(t){if(!this.config.preload)return;try{let n=mn(this.path);this.fileType=n.type,this.bytes=await n.bytes(),this.fileSize=this.bytes.byteLength}catch{throw`error: can't preload ${this.path}. File not found.`}}}var wt={path:Symbol("path"),wss:Symbol("wss"),file:Symbol("file"),folder:Symbol("folder"),error:Symbol("error")},hn=new U(...E(wt)),dt=(t)=>{let n=wt[t];if(!n)throw new Error("Invalid storage type");return hn[n]},R=(t,n,r={},o)=>{return(i)=>{let s=new Rt(n,r);if(i)s.serverClass=i;if(t==="file")s.loadBytes(o);return dt(t).set(s),i}},bt={args:{}};async function c(t){let[n,r]=dt(t).get(this.path);if(!n)return bt;let{requireSession:o}=n.config,i=void 0;if(o){if(i=await St(await this.request.authgroup(),r),!i)return bt}return{serverPath:n,args:r,session:i}}class Tt{}class z extends Tt{dir;apt;base;_statics;constructor(t=".",n={}){super();this.dir=t;let{root:r,base:o,appDir:i}=n;if(r)this.dir=r;this.apt=this.dir+"/"+(i??"client"),this.base=o??"",this.files=(...s)=>{s.forEach((e)=>{let[f,u]=xt.call(this,e),m=f.replace(/^\.+/,""),h=m.startsWith("/")?m:"/"+m;R("file",h,u,this.apt)()})},this.folders=(...s)=>{s.forEach((e)=>{R("folder",...xt.call(this,e))()})},this.statics=(s={})=>{if(!this._statics)this._statics={};d(this._statics,s)},this.route=(s)=>{return R("path",this._base(s))},this.wss=(s,e={})=>{return R("wss",this._base(s),e)},this.error=(...s)=>{return(e)=>{if(s.length)s.forEach((f)=>{R("error",this._base(f.toString()),{})(e)});else R("error",this._base("404"),{})(e);return e}},this.redirect=(s,e={})=>{return new Response("",{status:302,headers:new Headers({...e,Location:this._base(s)})})}}_base(t){return B(this.base,t)}}function xt(t){let n=X(t);return[n?this._base(t):this._base(t[0]),n?{}:t[1]]}var{inflateSync:Tn,serve:Cn,write:En}=globalThis.Bun;class Ct extends a{}var F=new Ct;var _={async open(t){let n=t.data.wclass,{args:r,client:o}=t.data;if(n){n.ws=t;let i=n.id,s=$(o);if(!(i in o)){let e=s?"joiner":"maker";o[i]={role:e}}if(typeof n.init=="function")await n.init(r);if(n.broadcasting)n.ws.subscribe(n.path);await n.open()}else t.close()},async message(t,n){let r=t.data.wclass;if(r)await r.message(n)},async close(t,n,r){let o=t.data.wclass,i=t.data.client;if(o){if(await o.close(n,r),o.broadcasting)o.ws.unsubscribe(o.path);let s=o.id;if(delete i[s],$(i)===1)Y(i).forEach((e)=>{i[e].role="maker"})}}};async function K(){let{serverPath:t,args:n,session:r}=await c.call(this,"wss");if(!t)return this.status=426,"upgrade error";let{serverClass:o}=t;if(!o)return"upgrade error";let i=new o(this.request);r&&i.setServerSession(r);let s=i.path,e=Et(s),f=e?.size??0,{broadcast:u,maxClient:m}=t.config;if(i.broadcasting=!!u,i.max=m??0,m&&f>=m)return this.status=400,"upgrade error";return this.request.upgradeConnection({data:{wclass:i,args:n,client:e}}),null}class $t extends x{request;ws;path;id;broadcasting=!1;max=0;constructor(t){super();this.request=t;this.path=t.path,this.id=y(10)}open(){}message(t){}close(t,n){}set send(t){if(t)if(this.broadcasting)this.ws.publish(this.path,t);else this.ws.send(t)}get role(){let t=F.get(this.path);if(t&&t.has(this.id))return t.get(this.id)?.role}}var Et=(t)=>{return F.init(t,new a)};var{deflateSync:bn,gzipSync:Rn}=globalThis.Bun;var{Server:ln,file:an}=globalThis.Bun;class q{req;server;formData;url;method;__cookies=new Map;constructor(t,n){this.req=t;this.server=n;this.url=new URL(t.url),this.method=this.req.method.toLowerCase()}async form(){if(this.isForm){if(!this.formData)this.formData=await this.req.formData();return this.formData}return new FormData}async authgroup(){let{cookies:t,auth:n}=this,r=t.get("session")??"",o=n??"",i="",s=this.isForm?await this.form():void 0;if(s){let e=s.get("refresh_token");i=e?e.toString():""}return{sid:r,jwtv:o,refreshjwt:i}}upgradeConnection(t={}){return!!this.server?.upgrade(this.req,t)}get auth(){let t=this.headers.get("authorization");if(t){let[n,r]=t.split(" ",2);if(n.trim()=="Bearer")return r.trim()}}get accept(){return this.headers.get("accept")}get contentType(){return this.headers.get("content-type")}get cookies(){if(!this.__cookies.size){let t=this.headers.get("cookie");if(t){let n=t.split(";").reduce((r,o)=>{let[i,s]=o.trim().split(/=(.*)/s);return r.push([i,s]),r},[]);this.__cookies=new Map(n)}}return this.__cookies}get headers(){return this.req.headers??new Headers}get ip(){return this.server?.requestIP(this.req)}get isForm(){let t=this.contentType;return t?t.indexOf("multipart/form-data")>=0||t.indexOf("x-www-form-urlencoded")>=0:!1}get path(){return this.url.pathname}get parsed(){let{parsed:t}=S(this.path);return t}get searchParams(){return this.url.searchParams}get range(){return this.headers.get("range")??void 0}get isEventStream(){return this.accept?.includes("text/event-stream")}get isWSS(){return!!this.headers.get("upgrade")}get isFile(){let t=this.parsed.slice().pop();return t?W(t,!0).pop()==="file":!1}get type(){return an(this.path).type}get upgrade(){return this.headers.get("upgrade")}get request(){return this.req}get signal(){return this.req.signal}}q=v([ht,tt("design:paramtypes",[typeof Request==="undefined"?Object:Request,typeof ln==="undefined"?Object:ln])],q);class qt{ctrl;intervalID=[];constructor(t){this.ctrl=t}push(t,n=2000){if(this.ctrl){let r=setInterval(()=>{let{id:o,retry:i,data:s,event:e,end:f}=t();if(this.ctrl){let u=f?"end":s;if(i){let m=i>2000?i:2000;this.ctrl.enqueue(`retry: ${m}\\n`)}if(this.ctrl.enqueue(`id: ${o}\\n`),e&&this.ctrl.enqueue(`event: ${e}\\n`),typeof u=="object")this.ctrl.enqueue("data: "+JSON.stringify(u)+"\\n\\\n");else this.ctrl.enqueue("data: "+JSON.stringify({message:u})+"\\n\\n");f&&this.close()}},n>1000?n:1000);this.intervalID.push(r)}}close(){if(this.intervalID.length)this.intervalID.forEach((t)=>{clearInterval(t)}),this.intervalID=[];this.ctrl?.close()}}async function Ot(t,n,r){this.status=200,this.header={"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"};let o=this.request,i=new ReadableStream({async start(e){t.stream=new qt(e),await r.call(t,n),o.signal.addEventListener("abort",()=>{if(t.stream?.close(),t.stream?.intervalID.length)e.close()})}}),s=await r.call(t,n);if(typeof s==="object"&&"error"in s)return this.status=s.error,null;return i}async function Dt(t){let n=l.jwtInt.save(t);return t.access_token=n,await l.jwt.saveSession(t,this.headers),{access_token:n,refresh_token:t.sid,status:"ok"}}function Jt(t){return this.status=403,{error:t}}async function Mt(t){let{jwtv:n,refreshjwt:r}=await this.request.authgroup();if(!r){if(n||!t.modified)return this.status=204,this.type="application/json",JSON.stringify({});return JSON.stringify(await Dt.call(this,t))}let o=await l.jwt.openSession(r),i=o.data.access_token,s={};if(n!==i)s=Jt.call(this,"tokens don't match.");else if(!l.jwtInt.verify(i,{days:5}))await l.jwt.saveSession(o,void 0,!0),s=Jt.call(this,"expired refresh_token.");else s=await Dt.call(this,o);return this.type="application/json",JSON.stringify(s)}var{file:cn}=globalThis.Bun;async function Pt(){let t=this.path,{parsed:n}=S(this.path),r=n.slice(0,-1).join("/");this.path=r;let{serverPath:o}=await c.call(this,"folder");if(!o)return null;return this.path=t,await V.call(this)}async function Bt(){let{serverPath:t}=await c.call(this,"file");if(!t)return await Pt.call(this);if(t.bytes)return k.call(this,t.bytes,t.fileSize);return await V.call(this)}async function V(){try{let t=cn(this.dir+this.path);if(t.type.startsWith("video/"))return k.call(this,t,t.size);else{let n=await t.bytes();return k.call(this,n,n.byteLength)}}catch{return`${this.path} file not found.`}}function k(t,n){let{type:r,range:o}=this.request;if(this.type=r,this.status=206,!o)return this.header={"Cache-Control":"max-age=86400, must-revalidate"},rt(t)?this.compress("gzip",t):t;let[i,s,e]=et(n,o);return this.header={"Content-Range":`bytes ${i}-${s}/${e}`,"Content-Length":n.toString()},t.slice(i,s+1)}async function Wt(t){return this.status=t.status,this.header=t.headers.toJSON(),await t.arrayBuffer()}import{ServerSide as gn}from"authored";function O(t,n){if(this.status=n||200,typeof t==="object")return this.type="application/json",JSON.stringify(t);return this.type="text/html",String(t)}async function Nt(t){if(t instanceof gn)return Mt.call(this,t);return O.call(this,t)}class D{type;render;data;constructor(t,n,r={}){this.type=t;this.render=n;this.data=r}static async jwt(t){return new D("jwt",t)}}async function Ut(t,n=!1){let{type:r,render:o,data:i}=t;switch(r){case"jwt":return"jwt"}return"render"}function yn(t){return this.status=t??204,null}async function Sn(t){let{header:n,status:r,__session:o}=t;if($(n))this.header=n;if(r)this.status=r;o&&await yt(o,this.headers)}async function H(t,n,r=!1){if(!n)return yn.call(this,t.status);if(typeof n==="object"&&"error"in n)return this.status=n.error,null;if(await Sn.call(this,t),n instanceof Response)return await Wt.call(this,n);if(n instanceof D){if(t.status)this.status=t.status;return await Ut.call(this,n,r)}switch(this.request.method){case"post":return Nt.call(this,n);default:return O.call(this,n)}}async function It(){let{serverPath:t,args:n,session:r}=await c.call(this,"path");if(!t)return this.request.isFile?await Bt.call(this):null;let{serverClass:o}=t;if(!o)return null;let i=new o(this.request,n);r&&i.setServerSession(r);let{isEventStream:s,method:e}=this.request;if(s&&i?.eventStream)return await Ot.call(this,i,n,i.eventStream);if(e==="options")return this.status=204,this.options(t.options);if(i?.[e]){let f=await i[e]();return this.status=200,this.compress("deflate",await H.call(this,i,f)??"")}return null}async function At(){let t=this.path;this.path=this.status.toString();let{serverPath:n,args:r,session:o}=await c.call(this,"error");if(this.path=t,!n)return null;let{serverClass:i}=n;if(!i)return null;let s=new i(this.request,r);s.status=this.status;let{method:e}=this.request;if(s?.[e]){let f=await s[e]();return this.compress("deflate",await H.call(this,s,f,!0)??"")}return null}class Ht extends x{request;args;status;stream;path;headers={};constructor(t,n={}){super();this.request=t;this.args=n;this.path=t.path}set header(t){d(this.headers,t)}get header(){return this.headers}set type(t){this.header={"Content-Type":t}}setCookie({key:t,val:n,path:r="/",days:o=31,httpOnly:i=!1}){let s=ct(t,n,{expires:new A().timed({day:o}),path:r,httpOnly:i,sameSite:"Strict"});this.header={"Set-Cookie":s}}deleteCookie(t){this.setCookie({key:t,val:"",days:0})}}class Qt{status=404;headers=new Headers({"Content-Type":"text/plain"});set header(t){p(t).forEach(([n,r])=>{this.headers.set(n,r)})}set type(t){this.headers.set("Content-Type",t)}options(t){return t+=", OPTIONS",this.header={Allow:t,"Access-Control-Allow-Methods":t,"Access-Control-Max-Age":"86400"},null}compress(t,n){let o=(t==="gzip"?Rn:bn)(n);return this.header={"Content-Length":o.byteLength.toString(),"Content-Encoding":t},o}get init(){return{status:this.status,headers:this.headers}}}class Q extends Qt{dir;base;request;path="";constructor(t,n,r="./",o=""){super();this.dir=r;this.base=o;this.request=new q(t,n)}async response(){let{path:t,isWSS:n}=this.request;this.path=this._base(t);let r=await(n?K:It).call(this);if(!r)r=await At.call(this);return new Response(r,this.init)}_base(t){return B(this.base,t)}}import{mkdirSync as wn,writeFileSync as dn,existsSync as Yt}from"fs";var{file:xn}=globalThis.Bun;var Xt=(t,n="")=>{if(Yt(t))return!0;return dn(t,n,{flag:"wx"}),!0},Gt=(t)=>{if(Yt(t))return!0;return wn(t,{recursive:!0}),!0},Zt=(t,n)=>{if(!n)Gt(t),Xt(t+"/.env",`SECRET_KEY="${y(20)}"
TLS_KEY=""
TLS_CERT=""`)},Lt=(t)=>{return p(process.env).filter(([n])=>n.startsWith("TLS_")).reduce((n,[r,o])=>{if(o){let i=r.replace("TLS_","").toLowerCase();n[i]=xn(t+"/"+o)}return n},{})};async function jt(t){let{server:n,wss:r}=t,o=Cn({...n,...this._statics&&{static:this._statics},port:n.port||3000,tls:Lt(this.dir),fetch:async(s,e)=>{return await new Q(s,e,this.apt,this.base).response()},websocket:{sendPings:!0,perMessageDeflate:!0,...r,..._}}),i=()=>{o.stop(),process.exit(0)};process.on("SIGINT",i),process.on("SIGTERM",i)}var zt=async(t,n,r="")=>{let{path:o,hostname:i,method:s,port:e,name:f}=t,m=await(await new Q({url:`http://${i??"127.0.0.1"}:${e||3000}${o}`,method:s??"GET"},void 0,n).response()).arrayBuffer(),h=f?`/${f}`:"";if(m.byteLength)await En(n+r+`${h}/index.html`,Tn(m));return h+"/index"};import{config as qn}from"dotenv";class Ft extends z{html;serve;constructor(t={}){super(".",t);let{envPath:n,session:r}=t,o=this.dir+"/.private";Zt(o,n),qn({path:(n?n:o)+"/.env"});let i=r??new $n({dir:this.dir});l.init(i),this.html=async(s={})=>{s.path=this._base(s.path||"/");let e=await zt(s,this.apt,this.base),f=new Date().toLocaleTimeString();M.p=`${e}.html @ ${f}`},this.serve=async(s={},e)=>await jt.call(this,{server:s,wss:e})}}export{$t as websocket,Ht as response,un as auths,Ft as Rossa,D as Render,M as $$};
